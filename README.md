# ğŸ“Š Daily Stock Summary - Automated Analysis with RAG

Automated Indonesian stock market news analysis using Claude Code + Milvus RAG.

## ğŸ”„ Complete Workflow

```
1. Scrape unlimited news â†’ 2. Index in Milvus â†’ 3. Semantic search â†’ 4. Claude analyzes â†’ 5. View on web server
```

### Why RAG?
**Problem:** Scraping 500+ articles exceeds Claude's context window (~200K tokens)

**Solution:** Store everything in Milvus vector DB, retrieve only the top 50 most relevant articles via semantic search

## ğŸš€ Quick Start

### Setup

```bash
# 1. Install Python dependencies
pip install -r requirements.txt

# 2. Start Milvus (RAG vector database)
cd rag
./start_milvus.sh
cd ..
```

### Run Analysis

```bash
# Run complete RAG pipeline
bash prepare_news.sh

# Analyze with Claude
bash run_daily_analysis.sh

# Start web server
python3 serve_report.py
```

Then open: **http://localhost:3131**

### Web UI for Milvus
Attu UI: **http://localhost:1233** (explore stored articles)

## ğŸ“ Files Overview

### Core Scripts
- **`main.py`** - Scrapes financial news (unlimited articles)
- **`rag_indexer.py`** - Embeds & stores articles in Milvus
- **`rag_query.py`** - Semantic search for relevant articles
- **`analysis_prompt.txt`** - Prompt template for Claude Code
- **`serve_report.py`** - Web server to display reports

### Automation Scripts
- **`prepare_news.sh`** - RAG pipeline (scrape â†’ index â†’ query)
- **`run_daily_analysis.sh`** - Complete automation + Claude analysis

### RAG Infrastructure
- **`rag/docker-compose.yml`** - Milvus + etcd + MinIO + Attu
- **`rag/start_milvus.sh`** - Start vector database
- **`rag/stop_milvus.sh`** - Stop vector database

### Generated Files
- **`news.txt`** - Raw scraped articles (unlimited)
- **`news_condensed.txt`** - Top 50 relevant articles (from RAG)
- **`daily_report.md`** - Final analysis report (generated by Claude)

## ğŸ¯ Manual Step-by-Step Usage

### Step 1: Scrape News (Unlimited)
```bash
python3 main.py
```
Creates `news.txt` with all scraped articles (no limit).

### Step 2: Index in Milvus
```bash
python3 rag_indexer.py
```
Embeds articles and stores in Milvus vector database.

### Step 3: Semantic Search
```bash
python3 rag_query.py --top_k 50 --max_chars 2000
```
Retrieves top 50 most relevant articles â†’ `news_condensed.txt`

Advanced queries:
```bash
# Focus on specific topics
python3 rag_query.py --query "Banking sector and interest rates" --top_k 30

# Get more articles
python3 rag_query.py --top_k 100 --max_chars 1500
```

### Step 4: Run Claude Code Analysis
```bash
cat analysis_prompt.txt | claude -p --dangerously-skip-permissions
```
Claude analyzes top articles and generates `daily_report.md`.

### Step 5: View Report on Web
```bash
python3 serve_report.py
```
Visit: http://localhost:3131

## ğŸŒ Web Server Features

- âœ… Auto-converts Markdown to HTML
- âœ… Clean, responsive UI
- âœ… Auto-refresh every 5 minutes
- âœ… Manual refresh button
- âœ… Serves on `0.0.0.0:3131` (accessible from network)

## ğŸ”§ Configuration

### Change Web Server Port
Edit `serve_report.py`:
```python
PORT = 3131  # Change this
```

### Scraping Sources
Edit `main.py` - `get_sites()` function to add/remove sources.

### Analysis Style
Edit `analysis_prompt.txt` to customize Claude's analysis approach.

## ğŸ“… Daily Automation with Cron

Run analysis automatically every day at 9 AM:

```bash
# Edit crontab
crontab -e

# Add this line:
0 9 * * * cd /home/arboapin/ai/daily-stock-summary && bash run_daily_analysis.sh >> cron.log 2>&1
```

Then keep the web server running:
```bash
# Run in background with nohup
nohup python3 serve_report.py > server.log 2>&1 &
```

## ğŸ› ï¸ Troubleshooting

### "daily_report.md not found"
Run the analysis first:
```bash
bash run_daily_analysis.sh
```

### Claude Code not responding
Make sure Claude Code CLI is installed and accessible:
```bash
which claude
```

### Port 3131 already in use
Change port in `serve_report.py` or kill existing process:
```bash
lsof -ti:3131 | xargs kill -9
```

## ğŸ“¦ Dependencies

See `requirements.txt` for full list:

```bash
pip install -r requirements.txt
```

Key packages:
- `requests`, `beautifulsoup4` - Web scraping
- `pymilvus` - Vector database client
- `sentence-transformers` - Multilingual embeddings
- `torch` - Deep learning backend

## ğŸ“ˆ Example Output

The generated `daily_report.md` includes:
- ğŸ“Š Market overview & sentiment
- ğŸ”¥ Most mentioned stocks
- ğŸ“ˆ Price movements & catalysts
- ğŸ’¡ Top 3 actionable recommendations
- ğŸ“° Individual article analysis

## âš ï¸ Disclaimer

This tool is for informational purposes only. Always conduct your own research before making investment decisions.

## ğŸ¤ Contributing

Feel free to customize the scripts for your needs!

---

**Created with â¤ï¸ using Claude Code**
